<!doctype html>
<html lang="en" ng-app="kappablob">
  <head>
  <meta charset="utf-8">
    <title ng-bind="htmltitle">Twitch Chat Stats</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

    <base href="/" />
    <style>
      body {
      }
      .arc path, g circle {
        stroke: #fff;
        stroke-width: 2;
      }
      g.pieslice:hover, g.node:hover {
        opacity: 0.5;
      }
      tr.pielight td {
        
      }
      tr.pielowlight td {
        opacity: 0.5;
      }
      div.piebox {
        border: 1px solid #fbeeee;
      }
      circle.glow {
        stroke: red;
        stroke-width:5px;
      }
      a {
        cursor:pointer;
      }
      #reloadchannels {
        cursor: pointer;
        font-size: 20px;
      }
      .buffer-top {
        margin-top:20px;
      }
      .buffer-bottom {
        margin-bottom:20px;
      }
      text {
        fill: #333;

      }
      nav {
          height: 60px;
          background:#202427;
      }
      nav h2 {
          line-height: 60px;
          font-family: Lato, sans-serif;
      }
      nav h2, nav div h3 {
          margin: 0;
      }
      nav div {
          width: 1100px;
          margin: 0 auto;
          display:flex;
          justify-content: space-between;
      }
      nav div h3 {
          display: flex;
          flex-direction:row;
      }
      nav div p {
          margin-left: 30px;
          list-style-type:none;
          line-height:60px;
      }
      nav * a, nav * p {
          color: #fff;
          text-decoration:none;
          font-family: Lato, sans-serif;
      }
    </style>
  </head>
  <body ng-controller="MainController">
    <nav>
      <div>
        <h2><a href="/">kappablob</a></h2>
        <p><span ng-click="reload_topchannels()" id="reloadchannels" title="Refresh">Top Channels:</span>
          
          <span ng-hide="twitch.loaded">loading...</span>
          <span ng-show="twitch.loaded" ng-repeat="c in twitch.topchannels | limitTo:5"><a href="/{{ c.channel.name }}">{{ c.channel.display_name }}</a>, </span>
        </p>
      </div>
    </nav>
    <div class="container">
      <div class="page-header" ng-hide="channel_loaded">
        <p>Top Channels:
          <span ng-hide="twitch.loaded">loading...</span>
          <span ng-show="twitch.loaded" ng-repeat="c in twitch.topchannels | limitTo:15"><a href="/{{ c.channel.name }}">{{ c.channel.display_name }}</a>, </span>
        </p>
      </div>
      <div ng-show="channel_loaded">
        <div id="channel_info" style="margin-top:15px" class="media" ng-show="!channel_not_live">
            <div class="media-left media-top">
              <img class="media-object" style="width:64px" src="{{ channel.stream.channel.logo }}" />
            </div>
            <div class="media-body">
              <h3 style="margin-top:0">{{ channel.stream.channel.display_name }} - <small>{{ channel.stream.channel.status }} <a href="{{ channel.stream.channel.url }}">(View on Twitch)</a></small></h3>
              <p>Viewers: {{ channel.stream.viewers }}</p>
            </div>
        </div>
        <div ng-show="channel_not_live">
          <h3>Channel is not live</h3>
        </div>
      </div>

      <div class="row-fluid buffer-bottom buffer-top">
        <div class="btn-group" role="group" aria-label="...">
          <!--<button style="display:none" type="button" class="btn btn-success" ng-model="running" ng-click="pause()">{{ running_text }}</button>-->
          <button type="button" class="btn btn-default" ng-class="{'btn-info': graphType == 'pie'}" ng-click="graphType = 'pie'">Pie</button>
          <button type="button" class="btn btn-default" ng-class="{'btn-info': graphType == 'bubble'}" ng-click="graphType = 'bubble'">Bubbles</button>
          <!--<button type="button" class="btn btn-default" ng-class="{'btn-info': graphType == 'force'}" ng-click="graphType = 'force'">Force</button>-->
          <button type="button" class="btn btn-default" ng-class="{'btn-info': graphType == 'list'}" ng-click="graphType = 'list'">List</button>
          <!--
          <button type="button" class="btn btn-default" disabled>Stacked</button>
          <button type="button" class="btn btn-default" disabled>Voronoi</button>
          -->
          <button type="button" class="btn btn-default" ng-click="clear()">Clear</button> 
        </div>
        
      </div>
      <div class="row-fluid">
        <div class="col-md-8 piebox" ng-show="is_graph()">
          <d3-graph data="totals" type="graphType"></d3-graph>
        </div>
        <div ng-cloak ng-show="graphType == 'list'" class="col-md-8">
          <h3>List ({{ total_messages() }} total)</h3>
          <table class="table table-striped table-bordered">
            <thead>
              <tr>
                <th>Message</th>
                <th>Count</th>
              </tr>
            </thead>
            <tbody>
              <tr ng-repeat="msg in list_of_messages()">
                <td>{{ msg.high }}</td>
                <td>{{ msg.count }}</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="col-md-4">

          <div ng-cloak ng-show="server() == true && channel_loaded" class="alert alert-success">Running &#x2714;</div>
          <div ng-cloak ng-show="server() == false && channel_loaded" class="alert alert-danger">Server offline</div>

          <div class="panel panel-default">
            <div class="panel-heading">Filters</div>
            <div style="" class="panel-body">
                
                  <div class="col-sm-10 input-group">
                    <input type="number" class="form-control" min="1" ng-model="min" ng-change="add_filter('minimum')" placeholder="Minimum" />
                    <a class="input-group-addon" title="Minimum count">?</a>
                  </div>                  
                  <br />
                  <div class="col-sm-10 input-group">
                    <input type="text" class="form-control" ng-model="compare" placeholder="Compare" />
                    <a class="input-group-addon" title="Restrict to only these (eg 'lul monkas')">?</a>
                  </div>
                  <br />
                  <div class="col-sm-10 input-group">
                    <input type="number" max="30" min="10" class="form-control" ng-model="limit" placeholder="Limit" />
                    <a class="input-group-addon" title="Maximum number of results to display">?</a>
                  </div>

                  <!--
                  <br />
                  <div class="col-sm-10 input-group">
                    <input type="text" class="form-control" ng-model="ignore" ng-change="do_ignore()" placeholder="Ignore" />
                    <a class="input-group-addon">[?]</a>
                  </div>-->
              
            </div>
          </div>
          <table class="table table-striped table-bordered" ng-hide="graphType == 'list'">
            <thead>
              <tr>
                <th class="span7">Message</th>
                <th class="span2">Count</th>
              </tr>
            </thead>
            <tbody>
              <tr ng-repeat="msg in list_of_messages()" id="{{ 'row-' + msg.md5 }}" ng-mouseover="highlight_bubble(msg.md5)" ng-mouseout="unhighlight_bubble(msg.md5)" ng-class="highlightWhich(msg)">
                <td class="span7">{{ msg.high | limitTo:30 }}</td>
                <td class="span2">{{ msg.count }}</td>
              </tr>
              <tr>
                <td colspan="2">and {{ hidden_singles }} others with a count of 1</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
    <script src="/node_modules/faye/client/faye-browser.js"></script>
    <script src="/static/kappa.js"></script>
    <script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="/js/blob-ng.js"></script>
    <script>
      //var client = new Faye.Client('ws://lvh.me:8000/ws');
    </script>
  </body>
</html>

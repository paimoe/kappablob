<!doctype html>
<html lang="en" ng-app="kappablob">
  <head>
    <title>Chat Example</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

    <base href="/" />
    <style>
      body {
      }
      .arc path, g circle {
        stroke: #fff;
        stroke-width: 2;
      }
      g.pieslice:hover, g.node:hover {
        opacity: 0.5;
      }
      tr.pielight td {
        
      }
      tr.pielowlight td {
        opacity: 0.5;
      }
      div.piebox {
        border: 1px solid grey;
      }
      circle.glow {
        stroke: red;
        stroke-width:5px;
      }
      a {
        cursor:pointer;
      }
    </style>
  </head>
  <body>
    <div class="container" ng-controller="MainController">
      <div class="page-header">
        <h1>kappaBlob: <a href="/about">about</a></h1>
        <h2>Top Channels: <span ng-hide="twitch.loaded">loading...</span>
          <span ng-show="twitch.loaded" ng-repeat="c in twitch.topchannels | limitTo:5"><a href="/{{ c.channel.name }}">{{ c.channel.display_name }}</a>&nbsp;</span>
        </h2>
      </div>
      <div ng-show="channel_loaded">
        <h3>{{ channel.stream.channel.display_name }} - <small>{{ channel.stream.channel.status }} <a href="{{ channel.stream.channel.url }}">(View on Twitch)</a></small></h3>
        <p>Viewers: {{ channel.stream.viewers }}</p>
      </div>
      <div>
        <button ng-model="running" ng-click="pause()" class="btn btn-success">{{ running_text }}</button> <button class="btn" ng-click="clear()">Clear</button> 
        
      </div>
      <div class="row-fluid">
        <div class="col-md-8 piebox">
          <d3-force data="totals" using="piehover"></d3-force>
        </div>
        <div class="col-md-4">

          <div class="panel panel-default">
            <div class="panel-heading">Filters</div>
            <div class="panel-body">
                
                  <div class="col-sm-10 input-group">
                    <input type="text" class="form-control" ng-model="minimum" ng-change="add_filter('minimum')" placeholder="Minimum" />
                    <a class="input-group-addon">[?]</a>
                  </div>
                  <br />
                  <div class="col-sm-10 input-group">
                    <input type="text" class="form-control" ng-model="compare" ng-change="do_compare()" placeholder="Compare" />
                    <a class="input-group-addon">[?]</a>
                  </div>
                  <br />
                  <div class="col-sm-10 input-group">
                    <input type="text" class="form-control" ng-model="ignore" ng-change="do_ignore()" placeholder="Ignore" />
                    <a class="input-group-addon">[?]</a>
                  </div>
                  <!--<input type="number" max="10" min="1" ng-model="limit" />-->
              
            </div>
          </div>
          <table class="table table-striped table-bordered">
            <thead>
              <tr>
                <th class="span7">Message</th>
                <th class="span2">Count</th>
              </tr>
            </thead>
            <tbody>
              <tr ng-repeat="msg in list_of_messages()" id="{{ 'row-' + msg[0] }}" ng-mouseover="highlight_bubble(msg[0])" ng-mouseout="unhighlight_bubble(msg[0])" ng-class="highlightWhich(msg)">
                <td class="span7">{{ msg[1].high | limitTo:30 }}</td>
                <td class="span2">{{ msg[1].count }}</td>
              </tr>
              <tr>
                <td colspan="2">and {{ hidden_singles }} others</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
    <script src="/socket.io/socket.io.js"></script>
    <script src="/js/jquery.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.5/angular.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.2.25/angular-route.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
    <script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="/js/blob-ng.js"></script>
    <script>
    function sortFuck(input, sortkey, direction) {
        //
        if (sortkey == 'random') {
            return _.shuffle(input);
        }
        input.sort(function(a, b, direction) {
            var x = a[sortkey]; var y = b[sortkey];
            var r = ((x < y) ? -1 : ((x > y) ? 1 : 0));
            return r;
        });
        if (direction == 'desc') {
            return input.reverse();
        }
        return input;
    };
    
    </script>
  </body>
</html>
